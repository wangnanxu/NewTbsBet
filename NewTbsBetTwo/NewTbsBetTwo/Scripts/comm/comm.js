var loginModule=angular.module("LoginModule",[]);var scoketModule=angular.module("ScoketModule",[]);var commModule=angular.module("CommModule",[]);var lobbyModule=angular.module("LobbyModule",[]);var infoModule=angular.module("InfoModule",[]);var statementModule=angular.module("StatementModule",[]);var settingModule=angular.module("SettingModule",[]);var gameModule=angular.module("GameModule",[]);
commModule.factory("LimitServ",["$rootScope",function($rootScope){var gamekindlimit=null;var memBetLimit=null;var lcBetLimit=null;var lcBetLimitByPos=null;var parmas=null;var BetPosMultiple={Player:1,Banker:1,Tie:0.1,PlayerPair:0.1,BankerPair:0.1,Big:1,Small:1,One:1,Two:2,Three:3,Four:4,Six:6,Dozen:10/4,Column:10/4,RedOrBack:10,BigOrSmall:10,SingleOrDouble:10,minbet:10/50,};var server={GetParmaLimit:GetParmaLimit,SetLimitArray:SetLimitArray,DestoryLobby:DestoryLobby,SetCurrentParmas:SetCurrentParmas,GetLimit:GetLimit,GetBaccMaxLimit:GetBaccMaxLimit,GetBaccMinLimit:GetBaccMinLimit,DestoryGame:DestoryGame};return server;function GetParmaLimit(data){if(data==null){return}var limitarr=data.UserLimit.split(";");var limitlen=limitarr.length;for(var i=0;i<limitlen;i++){if(gamekindlimit==null){gamekindlimit=new Array()}var arrlimit=limitarr[i].split("#");gamekindlimit.push(arrlimit)}var index=0;var ulimit=data.SystemLimit.split(";");var ulen=ulimit.length;while((index<ulen)){var limit=ulimit[index].split("#");if(limit.length==3){if(lcBetLimit==null){lcBetLimit=new Array()}if(lcBetLimitByPos==null){lcBetLimitByPos=new Array()}lcBetLimit[parseInt(limit[0])]=limit[1].split("|");lcBetLimitByPos[parseInt(limit[0])]=limit[2].split("|");var arr=lcBetLimitByPos[parseInt(limit[0])];var ind=0;var len=arr.length;for(ind;ind<len;ind++){if(arr[ind]==""||arr[ind]==null){arr[ind]=lcBetLimit[parseInt(limit[0])]}else{arr[ind]=arr[ind].split(",")}}lcBetLimitByPos[parseInt(limit[0])]=arr}index++}}function SetLimitArray(limittype,table){var index=0;var limitList=new Array;if(gamekindlimit==null){return}var len=gamekindlimit.length;for(var k=0;k<len;k++){if(parseInt(gamekindlimit[k][0])==table.GameKind){var arrlimit=new Array();arrlimit.push(gamekindlimit[k][1]);arrlimit.push(gamekindlimit[k][2]);memBetLimit=arrlimit;break}}if((((memBetLimit==null)||limittype<=0)||limittype>memBetLimit.length)){return limitList}var limit=memBetLimit[limittype-1].split("|");if((limit&&limit.length>0)){while((index<limit.length)){var limitID=limit[index];
var arr=lcBetLimitByPos[limitID];if((arr&&table.GameKind<=arr.length)){var list=arr[table.GameKind-1];if(list){limitList.push([limitID,list.join("-")]);var i=limitList.length-1;for(i;i>0;i--){for(var j=0;j<i;j++){if(limitList[j][1]==limitList[i][1]){limitList.pop()}}}}}index++}}return limitList}function SetCurrentParmas(data){if(data!=null){parmas=data}}function GetLimit(){if(lcBetLimitByPos&&parmas&&parmas.limit&&parmas.table){var list=lcBetLimitByPos[parmas.limit[0]];var limitByPos=list[parmas.table.GameKind-1]}return limitByPos}function GetBaccMaxLimit(){var limitByPos=GetLimit();if(limitByPos==null){return}var maxLimit=limitByPos[1];var maxlimit=[maxLimit*BetPosMultiple.Player,maxLimit*BetPosMultiple.Banker,maxLimit*BetPosMultiple.Tie,maxLimit*BetPosMultiple.PlayerPair,maxLimit*BetPosMultiple.BankerPair,maxLimit,maxLimit,maxLimit,maxLimit];return maxlimit}function GetBaccMinLimit(){var limitByPos=GetLimit();if(limitByPos==null){return}var minLimit=limitByPos[0];var minlimit=[minLimit*BetPosMultiple.Player,minLimit*BetPosMultiple.Banker,minLimit*BetPosMultiple.Tie,minLimit*BetPosMultiple.PlayerPair,minLimit*BetPosMultiple.BankerPair,minLimit,minLimit,0,0];return minlimit}function GetRoulBetLimit(){var betlimit="";return betlimit}function GetRoulMinLimit(){return minlimit}function DestoryGame(){parmas=null}function DestoryLobby(){parmas=null;gamekindlimit=null;memBetLimit=null;lcBetLimit=null;lcBetLimitByPos=null}}]);
commModule.factory("CommFun",["$timeout","$q","$http","$rootScope",function($timeout,$q,$http,$rootScope){$rootScope.rootmessage={type:"",able:false,message:""};var totaltime;var rightEle;var leftEle;var first=true;var callBack;var server={JsonToString:JsonToString,DoRefresh:DoRefresh,InitArray:InitArray,AssmbleArray:AssmbleArray,GetStatusText:GetStatusText,GetTableName:GetTableName,SetTotalTime:SetTotalTime,InitTimer:InitTimer,RangeDiv:RangeDiv,ShowMessage:ShowMessage,ExitLogin:ExitLogin,CloseMessage:CloseMessage,ConfirmMessage:ConfirmMessage};return server;function JsonToString(jsondata){var str="";for(var key in jsondata){str=str+","+jsondata[key]}str=str.substr(1);return str}function DoRefresh(data){$timeout(function(){data=data},0)}function InitArray(length,initdata){var arr=new Array();for(var i=0;i<length;i++){arr[i]=initdata}return arr}function GetStatusText(status){if($rootScope.language.Status[status]){return $rootScope.language.Status[status]}return $rootScope.language.Status[0]}function AssmbleArray(totalarr,count){if(totalarr==null){return}var length=totalarr.length;var page=Math.floor((length-1)/count)+1;var list=[];for(var i=0;i<page;i++){var arr=[];var startindex=count*i;var endindex=0;if(startindex+count<length){endindex=startindex+count}else{endindex=length}for(var j=startindex;j<endindex;j++){arr.push(totalarr[j])}list.push(arr)}return list}function ShowMessage(messageType,messageIndex,callback){$rootScope.rootmessage.able=true;$rootScope.rootmessage.type=messageType;switch(messageType){case $rootScope.MessageType.ExitLogin:$rootScope.rootmessage.message=$rootScope.language.Message.ExitLogin[messageIndex];break;case $rootScope.MessageType.GameStatus:$rootScope.rootmessage.message=$rootScope.language.Message.GameStatus[messageIndex];break;case $rootScope.MessageType.BetMessage:$rootScope.rootmessage.message=$rootScope.language.Message.BetMessage[messageIndex];break;case $rootScope.MessageType.OutNet:$rootScope.rootmessage.message=$rootScope.language.Message.OutNet[messageIndex];
break}callBack=callback;if(messageType==$rootScope.MessageType.GameStatus||messageType==$rootScope.MessageType.BetMessage){Timmer(1,HideMessage)}}function HideMessage(){$rootScope.rootmessage.able=false;$rootScope.rootmessage.message=""}function Timmer(time,callfun){$timeout(function(){time--;if(time<=0){callfun()}else{Timmer(time,callfun)}},1000)}function CloseMessage(){$rootScope.rootmessage.able=false;$rootScope.rootmessage.message=""}function ConfirmMessage(){if(typeof(callBack)=="function"){callBack()}}function ExitLogin(){location.reload()}function GetTableName(tablenames){var tableName="";if(tablenames&&tablenames.length>0){var arr=tablenames.split("|");switch($rootScope.lang.lang){case"CH":tableName=arr[1];break;case"EN":tableName=arr[0];break;case"TW":tableName=arr[2];break;default:tableName=arr[0];break}}return tableName}function SetTotalTime(bettime,rightid,leftid){totaltime=bettime;rightEle=document.getElementById(rightid);leftEle=document.getElementById(leftid)}function InitTimer(){first=true}function RangeDiv(difftime){if(difftime>totaltime){return}if(leftEle==null||rightEle==null){return}if(first){SetRange(leftEle,45);leftEle.style.borderBottomColor="#FFFF00";leftEle.style.borderLeftColor="#FFFF00";first=false}var range=360*difftime/totaltime;if(range>180){range=360-range+45;SetRange(rightEle,range)}else{range=180-range+45;SetRange(rightEle,225);SetRange(leftEle,range)}if(difftime<=5){leftEle.style.borderBottomColor="#FF3B30";leftEle.style.borderLeftColor="#FF3B30"}}function SetRange(ele,range){ele.style.transform="rotate("+range+"deg)";ele.style.webkitTransform="rotate("+range+"deg)";ele.style.MozTransform="rotate("+range+"deg)"}}]).directive("rootMessage",[function(){return{restrict:"E",templateUrl:"page/dirtective/rootmessage.html"}}]).directive("hideTabs",function($rootScope){return{restrict:"A",link:function(scope,element,attributes){scope.$watch(attributes.hideTabs,function(value){$rootScope.hideTabs=value});scope.$on("$destroy",function(){$rootScope.hideTabs=false
})}}});
scoketModule.factory("ScoketServ",["$timeout","$rootScope",function($timeout,$rootScope){var server={ConnectVideo:ConnectVideo,ConnectSinglaR:ConnectSinglaR,SendMessage:SendMessage,CloseSignalr:CloseSignalr,CloseVideo:CloseVideo};return server;var chatHub;function ConnectSinglaR(analysisfun,callback){try{$.connection.hub.logging=true;chatHub=$.connection.signalrPusher;chatHub.client.addMessage=function(mainCmd,subCmd,data){if(analysisfun){analysisfun(mainCmd,subCmd,data)}};registerClientMethods();$.connection.hub.start().done(function(){if(callback){callback()}})}catch(err){console.log("err:"+err.message)}}function SendMessage(maincmd,procmd,message){try{chatHub.server.send2Server(maincmd,procmd,message)}catch(err){console.log("??????"+maincmd+"-"+procmd+"err:"+err.message)}}function registerClientMethods(){try{chatHub.client.onConnected=function(id,userID,url){console.log("?????????"+url)};chatHub.client.onUserDisconnected=function(id,userID){console.log("?????????")};chatHub.client.onNewUserConnected=function(id,userID){console.log("????????")};chatHub.client.onExistUserConnected=function(id,userID){console.log("??"+userID+"??????")};chatHub.client.onExit=function(id,userID){console.log("??"+userID+"?????")}}catch(err){console.log("err:"+err.message)}}function CloseSignalr(){try{$.connection.hub.stop();chatHub=null}catch(err){console.log(err.message)}}var videourl;var client;var isBrownsClose=false;var player;function ConnectVideo(url){try{var canvas=document.getElementById("videoCanvas");videourl=url;client=new WebSocket(videourl);isBrownsClose=false;client.onopen=function(evt){console.log("video????"+evt)};client.onerror=function(evt){console.log("video??????"+evt)};client.onclose=function(evt){console.log("video??????"+evt);$timeout(function(){if(isBrownsClose==false){ConnectVideo(videourl)}},3000)};if(canvas){if(player){player.stop();player.destory();player=null}player=new jsmpeg(client,{canvas:canvas})}}catch(err){console.log("??????:"+err.message)}}function CloseVideo(){try{isBrownsClose=true;
if(player){player.stop();player.destory();player=null}if(client){client.close();client=null}var canvas=document.getElementById("videoCanvas");if(canvas){var ctx=canvas.getContext("2d");if(ctx){ctx.clearRect(0,0,canvas.width,canvas.height)}}}catch(err){console.log("???????"+err.message)}}}]);
scoketModule.factory("ConnectServ",["ScoketServ","ReceiveServ",function(ScoketServ,ReceiveServ){var server={ConnectSinglaR:ConnectSinglaR,CloseSignalr:CloseSignalr};return server;function ConnectSinglaR(callback){ScoketServ.ConnectSinglaR(ReceiveServ.ReceiveScoketData,callback)}function CloseSignalr(){ScoketServ.CloseSignalr()}}]).factory("ReceiveServ",["$rootScope","LobbyServ","GameReciveServ",function($rootScope,LobbyServ,GameReciveServ){var server={ReceiveScoketData:ReceiveScoketData};return server;function ReceiveScoketData(mainCmd,subCmd,pData){switch(mainCmd){case $rootScope.MainCommand.LobbyForMember:LobbyServ.AnalysisData(mainCmd,subCmd,pData);break;case $rootScope.MainCommand.GameServerForMember:GameReciveServ.AnalysisData(mainCmd,subCmd,pData);break;default:break}}}]).factory("VideoServ",["ScoketServ",function(ScoketServ){var server={ConnectVideo:ConnectVideo,CloseVideo:CloseVideo};return server;function ConnectVideo(url){ScoketServ.ConnectVideo(url)}function CloseVideo(){ScoketServ.CloseVideo()}}]).factory("SendServ",["ScoketServ",function(ScoketServ){var server={SendMessage:SendMessage,};return server;function SendMessage(maincmd,procmd,message){ScoketServ.SendMessage(maincmd,procmd,message)}}]);
commModule.factory("CommandServ",["$rootScope",function($rootScope){var server={GetCommandData:GetCommandData,cmdMemberLoginToMember:cmdMemberLoginToMember,cmdMemberBalance:cmdMemberBalance,cmdMemberTableInfo:cmdMemberTableInfo,cmdMemberTableStatus:cmdMemberTableStatus,cmdMemberTablePositionBet:cmdMemberTablePositionBet,cmdMemberTablePositionMembers:cmdMemberTablePositionMembers,cmdMemberTableHisRoad:cmdMemberTableHisRoad,cmdMemberTableDealer:cmdMemberTableDealer,cmdMemberSitResult:cmdMemberSitResult,cmdMemberStandUp:cmdMemberStandUp,cmdMemberInfo:cmdMemberInfo,cmdMemberBetBack:cmdMemberBetBack,cmdMemberPositionTotalBet:cmdMemberPositionTotalBet,cmdMemberPositionWin:cmdMemberPositionWin,cmdMemberChangeChairBack:cmdMemberChangeChairBack,cmdBaccStartBetToMember:cmdBaccStartBetToMember,cmdBaccCardInfo:cmdBaccCardInfo,cmdDragonCardInfo:cmdDragonCardInfo,cmdBaccResult:cmdBaccResult,cmdDragonResult:cmdDragonResult};return server;function GetCommandData(){$rootScope.MainCommand={LobbyForMember:2,GameServerForMember:4};$rootScope.LobbyForMember={Login:1,LogOut:2,Balance:3,TableInfo:4,TableStatus:5,TablePositionBet:6,TablePositionMembers:7,HisRoad:8,Dealer:9,OnlineMembers:10,SendTableEnd:11,CloseScoke:12};$rootScope.TableStatus={PausedTable:0,WaitingGame:1,BettingGame:2,OpenningResult:3,CalculatingWinLose:4,EndGame:5,ChangingBoot:6};$rootScope.GameForMember={SitDown:1,StandUp:2,MemberInfo:3,MemberBalace:4,Bet:5,PositionTotalBet:6,PositionWin:7,SetPassword:8,ChangeChair:9,CloseScoke:10};$rootScope.GameKindEnum={Baccarat:1,Roulette:2,SicBo:3,DragonTiger:4,Fantan:5,InsuranceBaccarat:6,BlackJack:7,VipBaccarat:8,ShareLookBaccarat:9};$rootScope.GameForBaccarat={StartBet:100,StopBet:101,NextRound:102,CardInfo:103,OpenResult:104,BaccResult:105,EndResult:106,LookCard:107,ChangeBoot:108,ChangeDealer:109,RoadInfo:110};$rootScope.GameForDragon={StartBet:100,StopBet:101,CardInfo:102,DragonResult:103,EndResult:104,ChangeBoot:105,ChangeDealer:106,RoadInfo:107,CancelRound:111};$rootScope.GameForRoulette={StartBet:100,StopBet:101,BallNum:102,RouletteResult:103,EndResult:104};
$rootScope.SitDownError={SitSuccess:0,SystemError:1,VIPMoreThreeNotBet:2,SeatError:3,NotVIP:4,Insufficient:5,ChairNumError:6,NoChairForHost:7,AlreadyHaveHostMember:8,NoHostMember:9,TablePasswordError:10,NoEmptyChair:11,SeatErrorForHaveBet:12};$rootScope.StandUpError={NetClose:1,NotVIP:2,Insufficient:3,NotBetMoreFive:4,NoHostMember:5,VIPTimeOut:6};$rootScope.MessageType={ExitLogin:"exitLogin",GameStatus:"gameStatus",BetMessage:"betMessage",OutNet:"outNet"}}function cmdMemberLoginToMember(datas){var _result={errID:0,memID:0,Account:"",ShowName:"",CasinoVIP:false,LoginCode:""};if(datas){var list=datas.split(",");_result.errID=parseInt(list[0]);_result.memID=parseInt(list[1]);_result.Account=list[2];_result.ShowName=list[3];_result.CasinoVIP=StringToBoolean(list[4]);_result.LoginCode=list[5]}return _result}function cmdMemberBalance(datas){var _result={memID:0,Balance:""};if(datas){var list=datas.split(",");_result.memID=parseInt(list[0]);_result.Balance=parseFloat(list[1])}return _result}function cmdMemberTableInfo(datas){var _result={TableID:0,TableName:"",TablePhone:"",RoomID:0,GameKind:0,ServerIP:"",ServerPort:0,LiveVideo1:"",LiveVideo2:"",LiveVideo3:"",LiveVideo4:"",LimitType:0,Dealer:"",Status:0,GameRoundNo:"",BetTime:0,DiffTime:0,SortNum:0,OnlineMembers:0,TotalCredit:0,HostMember:0,NeedPassword:false,PrivateTable:false,PositionMembers:"",PositionTotalBet:"",HisRoad:"",ControlMode:0};if(datas){var list=datas.split(",");_result.TableID=parseInt(list[0]);_result.TableName=list[1];_result.TablePhone=list[2];_result.RoomID=parseInt(list[3]);_result.GameKind=parseInt(list[4]);_result.ServerIP=list[5];_result.ServerPort=parseInt(list[6]);_result.LiveVideo1=list[7];_result.LiveVideo2=list[8];_result.LiveVideo3=list[9];_result.LiveVideo4=list[10];_result.LimitType=parseInt(list[11]);_result.Dealer=list[12];_result.Status=parseInt(list[13]);_result.GameRoundNo=list[14];_result.BetTime=parseInt(list[15]);_result.DiffTime=parseInt(list[16]);_result.SortNum=parseInt(list[17]);_result.OnlineMembers=parseInt(list[18]);
_result.TotalCredit=parseFloat(list[19]);_result.HostMember=parseInt(list[20]);_result.NeedPassword=StringToBoolean(list[21]);_result.PrivateTable=StringToBoolean(list[22]);_result.PositionMembers=list[23];_result.PositionTotalBet=list[24];_result.HisRoad=list[25];_result.ControlMode=parseInt(list[26])}return _result}function cmdMemberTableStatus(datas){var _result={TableID:0,Status:0,GameRoundNo:"",DiffTime:0,OnlineMembers:0,TotalCredit:0,HostMember:0,NeedPassword:false,PrivateTable:false};if(datas){var list=datas.split(",");_result.TableID=parseInt(list[0]);_result.Status=parseInt(list[1]);_result.GameRoundNo=list[2];_result.DiffTime=parseInt(list[3]);_result.OnlineMembers=parseInt(list[4]);_result.TotalCredit=parseFloat(list[5]);_result.HostMember=parseInt(list[6]);_result.NeedPassword=StringToBoolean(list[7]);_result.PrivateTable=StringToBoolean(list[8])}return _result}function cmdMemberTablePositionBet(datas){var _result={TableID:0,PositionBet:""};if(datas){var list=datas.split(",");_result.TableID=parseInt(list[0]);_result.PositionBet=list[1]}return _result}function cmdMemberTablePositionMembers(datas){var _result={TableID:0,PositionMembers:""};if(datas){var list=datas.split(",");_result.TableID=parseInt(list[0]);_result.PositionMembers=list[1]}return _result}function cmdMemberTableHisRoad(datas){var _result={TableID:0,HisRoad:""};if(datas){var list=datas.split(",");_result.TableID=parseInt(list[0]);_result.HisRoad=list[1]}return _result}function cmdMemberTableDealer(datas){var _result={TableID:0,Dealer:""};if(datas){var list=datas.split(",");_result.TableID=parseInt(list[0]);_result.Dealer=list[1]}return _result}function cmdMemberSitResult(datas){var _result={errID:0,Chair:0,LookOn:false};if(datas){var list=datas.split(",");_result.errID=parseInt(list[0]);_result.Chair=parseInt(list[1]);_result.LookOn=StringToBoolean(list[2])}return _result}function cmdMemberStandUp(datas){var _result={memID:0,Chair:0,errID:0};if(datas){var list=datas.split(",");_result.memID=parseInt(list[0]);
_result.Chair=parseInt(list[1]);_result.errID=parseInt(list[2])}return _result}function cmdMemberInfo(datas){var _result={memID:0,Chair:0,MoneyID:0,ShowName:"",Balance:0};if(datas){var list=datas.split(",");_result.memID=parseInt(list[0]);_result.Chair=parseInt(list[1]);_result.MoneyID=parseInt(list[2]);_result.ShowName=parseInt[3];_result.Balance=parseFloat(list[4])}return _result}function cmdMemberBetBack(datas){var _result={memID:0,Chair:0,BetPosition:0,err:0,BetAmount:0};if(datas){var list=datas.split(",");_result.memID=parseInt(list[0]);_result.Chair=parseInt(list[1]);_result.BetPosition=parseInt(list[2]);_result.err=parseInt(list[3]);_result.BetAmount=parseFloat(list[4])}return _result}function cmdMemberPositionTotalBet(datas){var _result={memID:0,Chair:0,TotalBet:""};if(datas){var list=datas.split(",");_result.memID=parseInt(list[0]);_result.Chair=parseInt(list[1]);_result.TotalBet=list[2]}return _result}function cmdMemberPositionWin(datas){var _result={memID:0,Chair:0,TotalWin:""};if(datas){var list=datas.split(",");_result.memID=parseInt(list[0]);_result.Chair=parseInt(list[1]);_result.TotalWin=list[2]}return _result}function cmdMemberChangeChairBack(datas){var _result={err:0,OldChair:0,NewChair:0};if(datas){var list=datas.split(",");_result.err=parseInt(list[0]);_result.OldChair=parseInt(list[1]);_result.NewChair=parseInt(list[2])}return _result}function cmdBaccStartBetToMember(datas){var _result={GameRoundNo:"",BetTime:0,DiffTime:0,Reset:false,Insurance:0,MaxBetRate:0,Odds:0};if(datas){var list=datas.split(",");_result.GameRoundNo=list[0];_result.BetTime=parseInt(list[1]);_result.DiffTime=parseInt(list[2]);_result.Reset=StringToBoolean(list[3]);_result.Insurance=parseInt(list[4]);_result.MaxBetRate=parseFloat(list[5]);_result.Odds=parseFloat(list[6])}return _result}function cmdBaccCardInfo(datas){var _result={GameRoundNo:"",Position:0,Index:0,CardNum:0,IsLookCard:false};if(datas){var list=datas.split(",");_result.GameRoundNo=list[0];_result.Position=parseInt(list[1]);
_result.Index=parseInt(list[2]);_result.CardNum=parseInt(list[3]);_result.IsLookCard=StringToBoolean(list[4])}return _result}function cmdDragonCardInfo(datas){var _result={GameRoundNo:"",Position:0,CardNum:0};if(datas){var list=datas.split(",");_result.GameRoundNo=list[0];_result.Position=parseInt(list[1]);_result.CardNum=parseInt(list[2])}return _result}function cmdBaccResult(datas){var _result={GameRoundNo:"",PlayerNumber:0,BankerNumber:0,RoadInfo:""};if(datas){var list=datas.split(",");_result.GameRoundNo=list[0];_result.PlayerNumber=parseInt(list[1]);_result.BankerNumber=parseInt(list[2]);_result.RoadInfo=list[3]}return _result}function cmdDragonResult(datas){var _result={GameRoundNo:"",Result:0};if(datas){var list=datas.split(",");_result.GameRoundNo=list[0];_result.Result=parseInt(list[1])}return _result}function StringToBoolean(str){var bool;switch(str){case"true":bool=true;break;case"false":bool=false;break;default:bool=false;break}return bool}}]);

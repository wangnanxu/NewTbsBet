gameModule.factory("BaccBigEyeTableServ",[function(){var parmas;var tableName="strBigEyesTable";var lastRoadView=null;var row=3;var posArray=[];var m_lang;var showArr=[];var tableid;var server={Initialize:Initialize,Shuffle:Shuffle,ShowRoad:ShowRoad,TableName:TableName,Destory:Destory};return server;function Initialize(parma,gametype,canvasid){posArray=new Array();posArray.push(new Array(row));parmas=parma[tableName];if(canvasid){tableid=canvasid}}function TableName(){return tableName}function Shuffle(){lastRoadView=null;showArr=[];posArray=new Array();posArray.push(new Array(row));ClearCanvas()}function ShowRoad(number,arrLength){if(!number||number==0){return}showArr.push(number);CountColumn(number);var len=showArr.length;if(len>=arrLength){if(posArray){var poslen=posArray.length;if(poslen>parmas.cols*2){var count=0;var startcol=poslen-parmas.cols*2;for(var i=startcol;i<poslen;i++){var lengthas=posArray[i].length;for(var j=0;j<6;j++){if(posArray[i][j]==1){count++}}}showArr=showArr.slice(arrLength-count,arrLength)}}lastRoadView=null;posArray=new Array();posArray.push(new Array(row));var length=showArr.length;for(var i=0;i<length;i++){Show(showArr[i])}}}function CountColumn(number){var rc=new BaccBigEyeViewServ();rc.RoadPosition(lastRoadView,number,posArray);lastRoadView=rc;FillingArray(rc._column,rc._row,1);_column=rc._column;_row=rc._row}function Show(number){if(!number||number==0){return}var rc=new BaccBigEyeViewServ();rc.BigEyesView(number,parmas,tableid);rc.RoadPosition(lastRoadView,number,posArray);rc.SetLang(m_lang);lastRoadView=rc;FillingArray(rc._column,rc._row,1);rc.CanvasView(number,rc._row,rc._column)}function FillingArray(i,j,val){if(posArray.length<i+1){posArray.push(new Array(row))}posArray[i][j]=val}function SetLang(strlang){m_lang=strlang}function Destory(){posArray=null;lastRoadView=null;showArr=null;parmas=null}function ClearCanvas(){var b_canvas=document.getElementById(tableid);if(b_canvas){var ctx=b_canvas.getContext("2d");ctx.clearRect(0,0,b_canvas.width,b_canvas.height)
}}}]);
gameModule.factory("CanvasServ",["$timeout",function($timeout){var server={GetParmas:GetParmas,CanvasTable:CanvasTable};return server;var parmas=[];function GetParmas(parma){parmas=parma}function CanvasTable(type,canvasid){var rows=parmas[type].rows;var cols=parmas[type].cols;var a_canvas=document.getElementById(canvasid);if(a_canvas){var context=a_canvas.getContext("2d");pointX=a_canvas.width*parmas[type].pointX;width=a_canvas.width*parmas[type].width;height=width*(rows/cols);pointY=height*parmas[type].pointY;var cell_height=height/rows;var cell_width=width/cols;context.lineWidth=1;context.strokeStyle="#000000";var gradient=context.createLinearGradient(0,0,0,300);gradient.addColorStop(0,"#e0e0e0");gradient.addColorStop(1,"#ffffff");context.fillStyle=gradient;context.fillRect(pointX,pointY,width,height);context.beginPath();for(var col=0;col<=cols;col++){var x=col*cell_width+pointX;context.moveTo(x,pointY);context.lineTo(x,pointY+height)}for(var row=0;row<=rows;row++){var y=row*cell_height+pointY;context.moveTo(pointX,y);context.lineTo(pointX+width,y)}context.stroke()}}}]);
var BaccViewServ=function(){var parmas;this.num=0;var _row=0;var _column=0;this.l_startColumn=0;var maxRow=6;var m_lang;var gameType;var viewid="";this.PearlView=function(parma,type,canvasid){gameType=type;parmas=parma;if(canvasid){viewid=canvasid}};this.RoadPosition=function(lastRPV,number,arr){var suite=0;if(lastRPV!=null){var lastPV=lastRPV;this.num=lastPV.num+1;suite=this.num}else{this.num=0;suite=0}_column=Math.floor(suite/maxRow);_row=Math.floor(suite%maxRow);this.CanvasView(number,_row,_column)};this.NonEmpty=function(param){if(param==undefined||param==null){return true}return false};this.Row=function(){return _row};this.Column=function(){return _column};this.SetLang=function(strlang){m_lang=strlang};this.CanvasView=function(num,row,col){if(viewid==""||viewid==null){return}var img=new Image();var str="";if(gameType=="bacc"){str="img/game/bacc/road/tableView/";switch(num){case 1:str=str+"banker.png";break;case 2:str=str+"player.png";break;case 3:str=str+"tie.png";break;case 4:str=str+"playerbp.png";break;case 5:str=str+"playerb.png";break;case 6:str=str+"playerp.png";break;case 7:str=str+"bankerbp.png";break;case 8:str=str+"bankerb.png";break;case 9:str=str+"bankerp.png";break;case 10:str=str+"tiebp.png";break;case 11:str=str+"tieb.png";break;case 12:str=str+"tiep.png";break}}else{if(gameType=="dragon"){str="img/game/dragon/";switch(num){case 1:str=str+"dragon.png";break;case 2:str=str+"tiger.png";break;case 3:str="img/game/bacc/road/tableView/tie.png";break}}}img.src=str;var b_canvas=document.getElementById(viewid);if(b_canvas){var ctx=b_canvas.getContext("2d");var rows=parmas.rows;var cols=parmas.cols;var pointX=b_canvas.width*parmas.pointX;var width=b_canvas.width*parmas.width;var height=width*(rows/cols);var pointY=height*parmas.pointY;var cell_height=height/rows;var cell_width=width/cols;var x=cell_width*col+pointX;var y=cell_height*row+pointY;img.onload=function(){ctx.drawImage(img,x+1,y+1,cell_width-2,cell_height-2)}}}};
gameModule.factory("BaccTableServ",[function(){var parmas;var tableName="strTable";var lastRoadView=null;var _column=0;var _row=0;var row=6;var posArray;var m_lang;var showArr=[];var gameType;var tableid;var server={Initialize:Initialize,Shuffle:Shuffle,ShowRoad:ShowRoad,TableName:TableName,Destory:Destory};return server;function Initialize(parma,type,canvasid){gameType=type;posArray=new Array();posArray.push(new Array(row));parmas=parma[tableName];if(canvasid){tableid=canvasid}}function TableName(){return tableName}function ShowRoad(number,arrLength){if(!number||number==0){return}showArr.push(number);var len=showArr.length;if(len>=arrLength){var count=parmas.cols*parmas.rows-3;if(len>count){showArr=showArr.slice(arrLength-count,arrLength)}var length=showArr.length;for(var i=0;i<length;i++){Show(showArr[i])}}}function Show(number){if(!number||number==0){return}var pt=new BaccViewServ();pt.PearlView(parmas,gameType,tableid);pt.SetLang(m_lang);pt.RoadPosition(lastRoadView,number);lastRoadView=pt;_column=pt.Column();_row=pt.Row()}function Shuffle(){showArr=[];lastRoadView=null;posArray=new Array();posArray.push(new Array(row));ClearCanvas()}function FillingArray(i,j,val){if(posArray.length<i+1){posArray.push(new Array(row))}posArray[i][j]=val}function SetLang(strlang){m_lang=strlang}function Destory(){parmas=null;lastRoadView=null;posArray=null;showArr=null}function ClearCanvas(){var b_canvas=document.getElementById(tableid);if(b_canvas){var ctx=b_canvas.getContext("2d");ctx.clearRect(0,0,b_canvas.width,b_canvas.height)}}}]);
var BaccSmallViewServ=function(){var parmas;this._row=0;this._column=0;var _width=0;var _height=0;this.l_startColumn=0;this.lastNum=0;var maxRow=6;var roadResult=[];var m_lang;var viewid="";this.SmallView=function(number,parma,canvasid){if(!number||number==0){return}parmas=parma;if(canvasid){viewid=canvasid}};this.RoadPosition=function(rpv,number,arr){if(!number||number==0){return}this.lastNum=number;if(rpv==null){}else{if(rpv.lastNum!=number){this._row=0;this._column=rpv.l_startColumn+1;this.l_startColumn=rpv.l_startColumn+1}else{this.l_startColumn=rpv.l_startColumn;if(rpv._row+1<maxRow&&this.NonEmpty(arr[rpv._column][rpv._row+1])){this._row=rpv._row+1;this._column=rpv._column}else{this._row=rpv._row;this._column=rpv._column+1}}}};this.NonEmpty=function(param){if(param==undefined||param==null){return true}return false};this.SetLang=function(strlang){m_lang=strlang};this.CanvasView=function(num,row,col){if(viewid==""||viewid==null){return}var img=new Image();var str="";switch(num){case 1:str="img/game/bacc/road/smallTableView/red.png";break;case 2:str="img/game/bacc/road/smallTableView/blue.png";break}img.src=str;var b_canvas=document.getElementById(viewid);if(b_canvas){var ctx=b_canvas.getContext("2d");var rows=parmas.rows;var cols=parmas.cols;var pointX=b_canvas.width*parmas.pointX;var width=b_canvas.width*parmas.width;var height=width*(rows/cols);var pointY=height*parmas.pointY;var cell_height=height/rows;var cell_width=width/cols;var x=cell_width/2*col+pointX;var y=cell_height/2*row+pointY;img.onload=function(){ctx.drawImage(img,x,y,cell_width/2,cell_height/2)}}}};
gameModule.factory("BaccSmallTableServ",[function(C){var parmas;var tableName="strSmallTable";var askRoad=null;var lastRoadView=null;var row=6;var posArray=[];var m_lang;var showArr=[];var tableid;var server={Initialize:Initialize,Shuffle:Shuffle,ShowRoad:ShowRoad,TableName:TableName,Destory:Destory};return server;function Initialize(parma,gametype,canvasid){posArray=new Array();posArray.push(new Array(row));parmas=parma[tableName];if(canvasid){tableid=canvasid}}function TableName(){return tableName}function Shuffle(){lastRoadView=null;showArr=[];posArray=new Array();posArray.push(new Array(row));ClearCanvas()}function ShowRoad(number,arrLength){if(!number||number==0){return}showArr.push(number);CountColumn(number);var len=showArr.length;if(len>=arrLength){if(posArray){var poslen=posArray.length;if(poslen>parmas.cols*2){var count=0;var startcol=poslen-parmas.cols*2;for(var i=startcol;i<poslen;i++){var lengthas=posArray[i].length;for(var j=0;j<6;j++){if(posArray[i][j]==1){count++}}}showArr=showArr.slice(arrLength-count,arrLength)}}lastRoadView=null;askRoad=null;posArray=new Array();posArray.push(new Array(row));var length=showArr.length;for(var i=0;i<length;i++){Show(showArr[i])}}}function CountColumn(number){var rc=new BaccSmallViewServ();rc.RoadPosition(lastRoadView,number,posArray);lastRoadView=rc;FillingArray(rc._column,rc._row,1);_column=rc._column;_row=rc._row}function Show(number){var rc=new BaccSmallViewServ();rc.SmallView(number,parmas,tableid);rc.RoadPosition(lastRoadView,number,posArray);rc.SetLang(m_lang);lastRoadView=rc;FillingArray(rc._column,rc._row,1);rc.CanvasView(number,rc._row,rc._column)}function FillingArray(i,j,val){if(posArray.length<i+1){posArray.push(new Array(row))}posArray[i][j]=val}function SetLang(strlang){m_lang=strlang}function Destory(){parmas=null;lastRoadView=null;posArray=null;showArr=null}function ClearCanvas(){var b_canvas=document.getElementById(tableid);if(b_canvas){var ctx=b_canvas.getContext("2d");ctx.clearRect(0,0,b_canvas.width,b_canvas.height)
}}}]);
gameModule.factory("BaccBigTableServ",[function(){var parmas;var _column=0;var _row=0;var tableName="strBigTable";var lastRoadView=null;var row=6;var posArray;var m_lang;var showArr=[];var tiecount=[];var tableid;var server={Initialize:Initialize,Shuffle:Shuffle,ShowRoad:ShowRoad,PosArray:PosArray,Row:Row,Column:Column,FShowRoad:FShowRoad,TableName:TableName,Destory:Destory};return server;function Initialize(parma,gametype,canvasid){posArray=new Array();posArray.push(new Array(row));parmas=parma[tableName];if(canvasid){tableid=canvasid}}function TableName(){return tableName}function ShowRoad(number,arrLength){if(!number||number==0){return}showArr.push(number);CountColumn(number);var len=showArr.length;if(len>=arrLength){if(posArray){var poslen=posArray.length;if(poslen>parmas.cols){var count=0;var startcol=poslen-parmas.cols;for(var i=startcol;i<poslen;i++){var lengthas=posArray[i].length;for(var j=0;j<6;j++){if(posArray[i][j]==1){count++}}}for(var k=startcol;k<tiecount.length;k++){if(tiecount[k]){count=count+tiecount[k]}}showArr=showArr.slice(arrLength-count,arrLength)}}lastRoadView=null;posArray=new Array();posArray.push(new Array(row));var length=showArr.length;for(var i=0;i<length;i++){Show(showArr[i])}}}function CountColumn(number){if((number==3)){if(lastRoadView){if(tiecount[lastRoadView._column]){tiecount[lastRoadView._column]=tiecount[lastRoadView._column]+1}else{tiecount[lastRoadView._column]=1}}else{tiecount[0]=1}return}else{var rc=new BaccBigViewServ();rc.BigView(number,parmas);rc.SetLang(m_lang);rc.RoadPosition(lastRoadView,number,posArray);lastRoadView=rc;FillingArray(rc._column,rc._row,1);_column=rc._column;_row=rc._row}}function Show(number){if((number==3)){if((lastRoadView==null)){return}else{lastRoadView.AddDrawResult(lastRoadView)}}else{var rc=new BaccBigViewServ();rc.BigView(number,parmas,tableid);rc.SetLang(m_lang);rc.RoadPosition(lastRoadView,number,posArray);lastRoadView=rc;FillingArray(rc._column,rc._row,1);_column=rc._column;_row=rc._row;rc.CanvasView(number,_row,_column)
}}function FShowRoad(number){if(!number||number==0){return}var rc=new BaccBigViewServ();rc.BigView(number,parmas);rc.SetLang(m_lang);rc.RoadPosition(lastRoadView,number,posArray);FillingArray(rc._column,rc._row,undefined);_column=rc._column;_row=rc._row}function PosArray(){return posArray}function Column(){return _column}function Row(){return _row}function Shuffle(){lastRoadView=null;showArr=[];tiecount=[];posArray=new Array();posArray.push(new Array(row));ClearCanvas()}function FillingArray(i,j,val){if(posArray.length<i+1){posArray.push(new Array(row))}posArray[i][j]=val}function SetLang(strlang){m_lang=strlang}function Destory(){parmas=null;lastRoadView=null;posArray=null;showArr=null;tiecount=null}function ClearCanvas(){var b_canvas=document.getElementById(tableid);if(b_canvas){var ctx=b_canvas.getContext("2d");ctx.clearRect(0,0,b_canvas.width,b_canvas.height)}}}]);
var BaccBigEyeViewServ=function(){var parmas;this._row=0;this._column=0;var _width=0;var _height=0;this.l_startColumn=0;this.lastNum=0;var maxRow=6;var roadResult=[];var m_lang;var viewid;this.BigEyesView=function(number,parma,canvasid){if(!number||number==0){return}width=height=_width=_height=5.75;parmas=parma;if(canvasid){viewid=canvasid}};this.RoadPosition=function(rpv,number,arr){if(!number||number==0){return}this.lastNum=number;if(rpv==null){}else{if(rpv.lastNum!=number){this._row=0;this._column=rpv.l_startColumn+1;this.l_startColumn=rpv.l_startColumn+1}else{this.l_startColumn=rpv.l_startColumn;if(rpv._row+1<maxRow&&this.NonEmpty(arr[rpv._column][rpv._row+1])){this._row=rpv._row+1;this._column=rpv._column}else{this._row=rpv._row;this._column=rpv._column+1}}}};this.NonEmpty=function(param){if(param==undefined||param==null){return true}return false};this.Row=function(){return _row};this.Column=function(){return _column};this.SetLang=function(strlang){m_lang=strlang};this.CanvasView=function(num,row,col){if(viewid==""||viewid==null){return}var img=new Image();var str="";switch(num){case 1:str="img/game/bacc/road/bigEyeTableView/red.png";break;case 2:str="img/game/bacc/road/bigEyeTableView/blue.png";break}img.src=str;var b_canvas=document.getElementById(viewid);if(b_canvas){var ctx=b_canvas.getContext("2d");var rows=parmas.rows;var cols=parmas.cols;var pointX=b_canvas.width*parmas.pointX;var width=b_canvas.width*parmas.width;var height=width*(rows/cols);var pointY=height*parmas.pointY;var cell_height=height/rows;var cell_width=width/cols;var x=cell_width/2*col+pointX;var y=cell_height/2*row+pointY;img.onload=function(){ctx.drawImage(img,x,y,cell_width/2,cell_height/2)}}}};
var BaccSmallForcedViewServ=function(){var parmas;this._row=0;this._column=0;var _width=0;var _height=0;this.l_startColumn=0;this.lastNum=0;var maxRow=6;var roadResult=[];var m_lang;var viewid;this.SmalllForcedView=function(number,parma,canvasid){if(!number||number==0){return}parmas=parma;if(canvasid){viewid=canvasid}};this.RoadPosition=function(rpv,number,arr){if(!number||number==0){return}this.lastNum=number;if(rpv==null){}else{if(rpv.lastNum!=number){this._row=0;this._column=rpv.l_startColumn+1;this.l_startColumn=rpv.l_startColumn+1}else{this.l_startColumn=rpv.l_startColumn;if(rpv._row+1<maxRow&&this.NonEmpty(arr[rpv._column][rpv._row+1])){this._row=rpv._row+1;this._column=rpv._column}else{this._row=rpv._row;this._column=rpv._column+1}}}};this.NonEmpty=function(param){if(param==undefined||param==null){return true}return false};this.SetLang=function(strlang){m_lang=strlang};this.CanvasView=function(num,row,col){if(viewid==""||viewid==null){return}var img=new Image();var str="";switch(num){case 1:str="img/game/bacc/road/smallForcedTableView/red.png";break;case 2:str="img/game/bacc/road/smallForcedTableView/blue.png";break}img.src=str;var b_canvas=document.getElementById(viewid);if(b_canvas){var ctx=b_canvas.getContext("2d");var rows=parmas.rows;var cols=parmas.cols;var pointX=b_canvas.width*parmas.pointX;var width=b_canvas.width*parmas.width;var height=width*(rows/cols);var pointY=height*parmas.pointY;var cell_height=height/rows;var cell_width=width/cols;var x=cell_width/2*col+pointX;var y=cell_height/2*row+pointY;img.onload=function(){ctx.drawImage(img,x,y,cell_width/2,cell_height/2)}}}};
gameModule.factory("BaccSmallForcedTableServ",[function(){var parmas;var tableName="strSmallForcedTablele";var lastRoadView=null;var row=6;var posArray=[];var m_lang;var showArr=[];var tableid;var server={Initialize:Initialize,Shuffle:Shuffle,ShowRoad:ShowRoad,TableName:TableName,Destory:Destory};return server;function Initialize(parma,gametype,canvasid){posArray=new Array();posArray.push(new Array(row));parmas=parma[tableName];if(canvasid){tableid=canvasid}}function TableName(){return tableName}function Shuffle(){lastRoadView=null;showArr=[];posArray=new Array();posArray.push(new Array(row));ClearCanvas()}function ShowRoad(number,arrLength){if(!number||number==0){return}showArr.push(number);CountColumn(number);var len=showArr.length;if(len>=arrLength){if(posArray){var poslen=posArray.length;if(poslen>parmas.cols*2){var count=0;var startcol=poslen-parmas.cols*2;for(var i=startcol;i<poslen;i++){var lengthas=posArray[i].length;for(var j=0;j<6;j++){if(posArray[i][j]==1){count++}}}showArr=showArr.slice(arrLength-count,arrLength)}}lastRoadView=null;askRoad=null;posArray=new Array();posArray.push(new Array(row));var length=showArr.length;for(var i=0;i<length;i++){Show(showArr[i])}}}function CountColumn(number){var rc=new BaccSmallForcedViewServ();rc.RoadPosition(lastRoadView,number,posArray);lastRoadView=rc;FillingArray(rc._column,rc._row,1)}function Show(number){var rc=new BaccSmallForcedViewServ();rc.SmalllForcedView(number,parmas,tableid);rc.RoadPosition(lastRoadView,number,posArray);rc.SetLang(m_lang);lastRoadView=rc;FillingArray(rc._column,rc._row,1);rc.CanvasView(number,rc._row,rc._column)}function FillingArray(i,j,val){if(posArray.length<i+1){posArray.push(new Array(row))}posArray[i][j]=val}function SetLang(strlang){m_lang=strlang}function Destory(){parmas=null;lastRoadView=null;posArray=null;showArr=null}function ClearCanvas(){var b_canvas=document.getElementById(tableid);if(b_canvas){var ctx=b_canvas.getContext("2d");ctx.clearRect(0,0,b_canvas.width,b_canvas.height)
}}}]);
gameModule.factory("LobbyHisToryManager",["BaccTableServ","$timeout","CanvasServ",function(BaccTableServ,$timeout,CanvasServ){var newBgResult=-1;var parmas=null;var bt=null;var strPearlTable;var strBigTable;var strBigEyesTable;var strSmallTable;var strSmallForcedTablele;var strRoadInfo;var roadView=[];var roadLoadView=[];var column=0;var row=0;var bigArr=null;var maxRow=6;var BEType=1;var SType=2;var SFType=3;var arrResult=[];var localResultArray=[];var sameCount=10;var forwardNumber=20;var resoultList=[];var roadstr;var m_lang;var arrLength=new Array(5);var isAsk=false;var bAsk=true;var pAsk=true;var askArr;var gameType;var tablecanvasId="a_canvas";var viewcanvasId="b_canvas";var server={BaccaratHistoryResultManger:BaccaratHistoryResultManger,StringSplit:StringSplit,Askb:Askb,Askp:Askp,Destory:Destory};return server;function BaccaratHistoryResultManger(gametype,type,tableid,viewid){if(tableid){tablecanvasId=tableid}if(viewid){viewcanvasId=viewid}parmas={strTable:{"rows":6,"cols":11,"pointX":0.15,"pointY":0,"width":0.7}};gameType=gametype;strPearlTable=BaccTableServ;roadView=new Array();if(strPearlTable!=null&&strPearlTable!=""){roadView.push(strPearlTable)}if(strBigTable!=null&&strBigTable!=""){roadView.push(strBigTable)}if(strBigEyesTable!=null&&strBigEyesTable!=""){roadView.push(strBigEyesTable)}if(strSmallTable!=null&&strSmallTable!=""){roadView.push(strSmallTable)}if(strSmallForcedTablele!=null&&strSmallForcedTablele!=""){roadView.push(strSmallForcedTablele)}if(strRoadInfo!=null&&strRoadInfo!=""){roadView.push(strRoadInfo)}roadLoadView=new Array();CanvasServ.GetParmas(parmas);ShowTable()}function StringSplit(strServerResult,bool){if(bool==false){roadstr=strServerResult}if(resoultList==null){resoultList=[0,0,0,0]}isAsk=bool;if(strServerResult==""){Shuffle();return resoultList}var index=-1;var serverResult=new Array();serverResult=strServerResult.split("|");Shuffle();for(var i=0;i<5;i++){arrLength[i]=serverResult.length}for(var i=0;i<serverResult.length;i++){ShowRoad(serverResult[i])
}return resoultList}function ShowRoad(strNumber){if(roadView==null){return}var lenght=roadView.length;arrResult=BaccaratResult(strNumber);if(arrResult){ShowRoadTable(arrResult)}}function BaccaratResult(strNumber){if(strNumber==null||strNumber==""){return null}var lenght=roadView.length;var Result=new Array(lenght);var blankPlay=0;switch(strNumber.substring(0,1)){case"0":blankPlay=3;resoultList[2]+=1;break;case"1":blankPlay=1;resoultList[0]+=1;break;case"2":blankPlay=2;resoultList[1]+=1;break}switch(strNumber.substr(1,2)){case"00":Result[0]=blankPlay;break;case"01":if(blankPlay==1){Result[0]=9}else{if(blankPlay==2){Result[0]=6}else{Result[0]=12}}break;case"10":if(blankPlay==1){Result[0]=8}else{if(blankPlay==2){Result[0]=5}else{Result[0]=11}}break;case"11":if(blankPlay==1){Result[0]=7}else{if(blankPlay==2){Result[0]=4}else{Result[0]=10}}break}if(gameType=="dragon"){Result[0]=blankPlay}Result[1]=blankPlay;Result[lenght-1]=Result[0];return Result}function ShowRoadTable(arr){if(!roadView||roadView.length<1){return}var index=0;while(index<roadView.length){if(roadLoadView[index]==null){var rtable=roadView[index];roadLoadView[index]=rtable;rtable.InitTable()}var className=roadLoadView[index];switch(className.TableName()){case"strBigEyesTable":if(arr[1]==3){arrLength[index]=arrLength[index]-1}if(newBgResult!=-1&&newBgResult!=3){arr[index]=AttachedResult(column,row,BEType)}else{arr[index]=0}if(arr[index]==0){arrLength[index]=arrLength[index]-1}break;case"strSmallTable":if(arr[1]==3){arrLength[index]=arrLength[index]-1}if(newBgResult!=-1&&newBgResult!=3){arr[index]=AttachedResult(column,row,SType)}else{arr[index]=0}if(arr[index]==0){arrLength[index]=arrLength[index]-1}break;case"strSmallForcedTablele":if(arr[1]==3){arrLength[index]=arrLength[index]-1}if(newBgResult!=-1&&newBgResult!=3){arr[index]=AttachedResult(column,row,SFType)}else{arr[index]=0}if(arr[index]==0){arrLength[index]=arrLength[index]-1}break}if(!NonEmpty(arr[index])&&arr[index]!=0){roadLoadView[index].ShowRoad(arr[index],arrLength[index]);
if(className==strBigTable){if(bt==null){bt=roadLoadView[index]}column=roadLoadView[index].Column();row=roadLoadView[index].Row();bigArr=roadLoadView[index].PosArray();newBgResult=arr[index]}}index++}}function Shuffle(){if((roadLoadView&&roadLoadView.length>0)){var index=0;while((index<roadLoadView.length)){if(roadLoadView[index]){roadLoadView[index].Shuffle()}index++}}localResultArray=null;bigArr=null;isAsk=false;arrLength=new Array(5);resoultList=[0,0,0,0]}function GetResoultList(){return resoultList}function ShowTable(){var index=0;while(index<roadView.length){if(roadLoadView[index]==null){var rtable=roadView[index];roadLoadView[index]=rtable;rtable.Initialize(parmas,gameType,viewcanvasId);var type=rtable.TableName();CanvasServ.CanvasTable(type,tablecanvasId)}index++}}function AttachedResult(c,r,type){var ret=0;if((bigArr==null)){return ret}var c_star=2,c_last=3;if((type==BEType)){c_star=2;c_last=3}else{if((type==SType)){c_star=3;c_last=4}else{if((type==SFType)){c_star=4;c_last=5}}}if(bigArr.length<c_star){return ret}if(bigArr.length==c_star){if(NonEmpty(bigArr[c_star-1][1])){return ret}}if(bigArr.length>=c_last){if(NonEmpty(bigArr[c_star-1][1])&&NonEmpty(bigArr[c_last-1][0])){return ret}}if((row==0)){for(var n=0;n<maxRow;n++){if(((NonEmpty(bigArr[c-c_star][n])&&!NonEmpty(bigArr[c-1][n]))||!NonEmpty(bigArr[c-c_star][n])&&NonEmpty(bigArr[c-1][n]))){ret=2;break}else{if((NonEmpty(bigArr[c-c_star][n])&&NonEmpty(bigArr[c-1][n]))){ret=1;break}}}}else{if(!NonEmpty(bigArr[c-c_star+1][r])){ret=1}else{if(NonEmpty(bigArr[c-c_star+1][r-1])){ret=1}else{ret=2}}}return ret}function NonEmpty(param){if(((param==undefined)||param==null)){return true}return false}function SetLang(strlang){var index=0;for(index;index<roadLoadView.length;index++){roadLoadView[index].SetLang(strlang)}m_lang=strlang;if(roadstr){StringSplit(roadstr)}}function Askb(){if(bAsk){bAsk=false;pAsk=true;askArr=roadstr+"|1001";StringSplit(askArr,true);$timeout(function(){bAsk=true;StringSplit(roadstr,false)},3000)
}}function Askp(){if(pAsk){bAsk=true;pAsk=false;askArr=roadstr+"|2001";StringSplit(askArr,true);$timeout(function(){pAsk=true;StringSplit(roadstr,false)},3000)}}function Destory(){parmas=null;if(strPearlTable){strPearlTable.Destory();strPearlTable=null}if(strBigTable){strBigTable.Destory();strBigTable=null}if(strBigEyesTable){strBigEyesTable.Destory();strBigEyesTable=null}if(strSmallForcedTablele){strSmallForcedTablele.Destory();strSmallForcedTablele=null}if(strSmallTable){strSmallTable.Destory();strSmallTable=null}strRoadInfo=null;roadView=null;roadLoadView=null;bigArr=null;arrResult=null;localResultArray=null;resoultList=null;roadstr=null;arrLength=null;askArr=null;bt=null}}]);
gameModule.factory("BaccHisToryManager",["BaccTableServ","BaccBigTableServ","BaccBigEyeTableServ","$timeout","CanvasServ",function(BaccTableServ,BaccBigTableServ,BaccBigEyeTableServ,$timeout,CanvasServ){var newBgResult=-1;var parmas=null;var bt=null;var strPearlTable;var strBigTable;var strBigEyesTable;var strSmallTable;var strSmallForcedTablele;var strRoadInfo;var roadView=[];var roadLoadView=[];var column=0;var row=0;var bigArr=null;var maxRow=6;var BEType=1;var SType=2;var SFType=3;var arrResult=[];var localResultArray=[];var sameCount=10;var forwardNumber=20;var resoultList=[];var roadstr;var m_lang;var arrLength=new Array(5);var isAsk=false;var bAsk=true;var pAsk=true;var askArr;var gameType;var tablecanvasId="a_canvas";var viewcanvasId="b_canvas";var server={BaccaratHistoryResultManger:BaccaratHistoryResultManger,StringSplit:StringSplit,Askb:Askb,Askp:Askp,Destory:Destory};return server;function BaccaratHistoryResultManger(gametype){parmas={strTable:{"rows":6,"cols":6,"pointX":0.015,"pointY":0,"width":0.35},strBigTable:{"rows":6,"cols":12,"pointX":0.016,"pointY":0,"width":0.35},strBigEyesTable:{"rows":3,"cols":12,"pointX":0.016,"pointY":2.1,"width":0.35}};gameType=gametype;strPearlTable=BaccTableServ;strBigTable=BaccBigTableServ;strBigEyesTable=BaccBigEyeTableServ;roadView=new Array();if(strPearlTable!=null&&strPearlTable!=""){roadView.push(strPearlTable)}if(strBigTable!=null&&strBigTable!=""){roadView.push(strBigTable)}if(strBigEyesTable!=null&&strBigEyesTable!=""){roadView.push(strBigEyesTable)}if(strSmallTable!=null&&strSmallTable!=""){roadView.push(strSmallTable)}if(strSmallForcedTablele!=null&&strSmallForcedTablele!=""){roadView.push(strSmallForcedTablele)}if(strRoadInfo!=null&&strRoadInfo!=""){roadView.push(strRoadInfo)}roadLoadView=new Array();CanvasServ.GetParmas(parmas);ShowTable()}function StringSplit(strServerResult,bool){if(bool==false){roadstr=strServerResult}if(resoultList==null){resoultList=[0,0,0,0]}isAsk=bool;if(strServerResult==""){Shuffle();return resoultList
}var index=-1;var serverResult=new Array();serverResult=strServerResult.split("|");Shuffle();for(var i=0;i<5;i++){arrLength[i]=serverResult.length}for(var i=0;i<serverResult.length;i++){ShowRoad(serverResult[i])}return resoultList}function ShowRoad(strNumber){if(roadView==null){return}var lenght=roadView.length;arrResult=BaccaratResult(strNumber);if(arrResult){ShowRoadTable(arrResult)}}function BaccaratResult(strNumber){if(strNumber==null||strNumber==""){return null}var lenght=roadView.length;var Result=new Array(lenght);var blankPlay=0;switch(strNumber.substring(0,1)){case"0":blankPlay=3;resoultList[2]+=1;break;case"1":blankPlay=1;resoultList[0]+=1;break;case"2":blankPlay=2;resoultList[1]+=1;break}switch(strNumber.substr(1,2)){case"00":Result[0]=blankPlay;break;case"01":if(blankPlay==1){Result[0]=9}else{if(blankPlay==2){Result[0]=6}else{Result[0]=12}}break;case"10":if(blankPlay==1){Result[0]=8}else{if(blankPlay==2){Result[0]=5}else{Result[0]=11}}break;case"11":if(blankPlay==1){Result[0]=7}else{if(blankPlay==2){Result[0]=4}else{Result[0]=10}}break}if(gameType=="dragon"){Result[0]=blankPlay}Result[1]=blankPlay;Result[lenght-1]=Result[0];return Result}function ShowRoadTable(arr){if(!roadView||roadView.length<1){return}var index=0;while(index<roadView.length){if(roadLoadView[index]==null){var rtable=roadView[index];roadLoadView[index]=rtable;rtable.InitTable()}var className=roadLoadView[index];switch(className.TableName()){case"strBigEyesTable":if(arr[1]==3){arrLength[index]=arrLength[index]-1}if(newBgResult!=-1&&newBgResult!=3){arr[index]=AttachedResult(column,row,BEType)}else{arr[index]=0}if(arr[index]==0){arrLength[index]=arrLength[index]-1}break;case"strSmallTable":if(arr[1]==3){arrLength[index]=arrLength[index]-1}if(newBgResult!=-1&&newBgResult!=3){arr[index]=AttachedResult(column,row,SType)}else{arr[index]=0}if(arr[index]==0){arrLength[index]=arrLength[index]-1}break;case"strSmallForcedTablele":if(arr[1]==3){arrLength[index]=arrLength[index]-1}if(newBgResult!=-1&&newBgResult!=3){arr[index]=AttachedResult(column,row,SFType)
}else{arr[index]=0}if(arr[index]==0){arrLength[index]=arrLength[index]-1}break}if(!NonEmpty(arr[index])&&arr[index]!=0){roadLoadView[index].ShowRoad(arr[index],arrLength[index]);if(className==strBigTable){if(bt==null){bt=roadLoadView[index]}column=roadLoadView[index].Column();row=roadLoadView[index].Row();bigArr=roadLoadView[index].PosArray();newBgResult=arr[index]}}index++}}function Shuffle(){if((roadLoadView&&roadLoadView.length>0)){var index=0;while((index<roadLoadView.length)){if(roadLoadView[index]){roadLoadView[index].Shuffle()}index++}}localResultArray=null;bigArr=null;isAsk=false;arrLength=new Array(5);resoultList=[0,0,0,0]}function GetResoultList(){return resoultList}function ShowTable(){var index=0;while(index<roadView.length){if(roadLoadView[index]==null){var rtable=roadView[index];roadLoadView[index]=rtable;var type=rtable.TableName();switch(type){case"strTable":viewcanvasId="aa_canvas";tablecanvasId="ba_canvas";break;case"strBigTable":viewcanvasId="ab_canvas";tablecanvasId="bb_canvas";break;case"strBigEyesTable":viewcanvasId="ac_canvas";tablecanvasId="bc_canvas";break}rtable.Initialize(parmas,gameType,viewcanvasId);CanvasServ.CanvasTable(type,tablecanvasId)}index++}}function AttachedResult(c,r,type){var ret=0;if((bigArr==null)){return ret}var c_star=2,c_last=3;if((type==BEType)){c_star=2;c_last=3}else{if((type==SType)){c_star=3;c_last=4}else{if((type==SFType)){c_star=4;c_last=5}}}if(bigArr.length<c_star){return ret}if(bigArr.length==c_star){if(NonEmpty(bigArr[c_star-1][1])){return ret}}if(bigArr.length>=c_last){if(NonEmpty(bigArr[c_star-1][1])&&NonEmpty(bigArr[c_last-1][0])){return ret}}if((row==0)){for(var n=0;n<maxRow;n++){if(((NonEmpty(bigArr[c-c_star][n])&&!NonEmpty(bigArr[c-1][n]))||!NonEmpty(bigArr[c-c_star][n])&&NonEmpty(bigArr[c-1][n]))){ret=2;break}else{if((NonEmpty(bigArr[c-c_star][n])&&NonEmpty(bigArr[c-1][n]))){ret=1;break}}}}else{if(!NonEmpty(bigArr[c-c_star+1][r])){ret=1}else{if(NonEmpty(bigArr[c-c_star+1][r-1])){ret=1}else{ret=2}}}return ret
}function NonEmpty(param){if(((param==undefined)||param==null)){return true}return false}function SetLang(strlang){var index=0;for(index;index<roadLoadView.length;index++){roadLoadView[index].SetLang(strlang)}m_lang=strlang;if(roadstr){StringSplit(roadstr)}}function Askb(){if(bAsk){bAsk=false;pAsk=true;askArr=roadstr+"|1001";StringSplit(askArr,true);$timeout(function(){bAsk=true;StringSplit(roadstr,false)},3000)}}function Askp(){if(pAsk){bAsk=true;pAsk=false;askArr=roadstr+"|2001";StringSplit(askArr,true);$timeout(function(){pAsk=true;StringSplit(roadstr,false)},3000)}}function Destory(){parmas=null;if(strPearlTable){strPearlTable.Destory();strPearlTable=null}if(strBigTable){strBigTable.Destory();strBigTable=null}if(strBigEyesTable){strBigEyesTable.Destory();strBigEyesTable=null}if(strSmallForcedTablele){strSmallForcedTablele.Destory();strSmallForcedTablele=null}if(strSmallTable){strSmallTable.Destory();strSmallTable=null}strRoadInfo=null;roadView=null;roadLoadView=null;bigArr=null;arrResult=null;localResultArray=null;resoultList=null;roadstr=null;arrLength=null;askArr=null;bt=null}}]);
var BaccBigViewServ=function(){var parmas;var txtDraw=null;var _drawCount=0;this._row=0;this._column=0;this.l_startColumn=0;this.lastNum=0;var maxRow=6;var m_lang;var viewid;var tiecount;var lastroad;var imglist=["zero","one","two","three","four","five","six","seven","eight","nine"];this.BigView=function(number,parma,canvasid){if(!number||number==0){return}if(!parma){return}parmas=parma;if(canvasid){viewid=canvasid}};this.AddDrawResult=function(rp){_drawCount++;if((_drawCount==1)){this.CanvasView(3,rp._row,rp._column)}else{this.CanvasView(4,rp._row,rp._column)}};this.RoadPosition=function(rpv,number,arr){if(!number||number==0){return}this.lastNum=number;if(rpv==null){}else{if(rpv.lastNum!=number){this._row=0;this._column=rpv.l_startColumn+1;this.l_startColumn=rpv.l_startColumn+1}else{this.l_startColumn=rpv.l_startColumn;if(rpv._row+1<maxRow&&this.NonEmpty(arr[rpv._column][rpv._row+1])){this._row=rpv._row+1;this._column=rpv._column}else{this._row=rpv._row;this._column=rpv._column+1}}}};this.NonEmpty=function(param){if(param==undefined||param==null){return true}return false};this.SetLang=function(strlang){m_lang=strlang};this.CanvasView=function(num,row,col){var isText=false;if(viewid==""||viewid==null){return}var str="";switch(num){case 1:str="img/game/bacc/road/bigTableView/banker.png";isText=false;tiecount=0;lastroad=1;break;case 2:str="img/game/bacc/road/bigTableView/player.png";isText=false;tiecount=0;lastroad=2;break;case 3:str="img/game/bacc/road/bigTableView/tie.png";isText=false;tiecount++;break;case 4:isText=true;tiecount++;if(lastroad==1){str="img/game/bacc/road/bigTableView/banker.png"}else{str="img/game/bacc/road/bigTableView/player.png"}break}var img=new Image();img.src=str;var b_canvas=document.getElementById(viewid);if(b_canvas){var ctx=b_canvas.getContext("2d");var rows=parmas.rows;var cols=parmas.cols;var pointX=b_canvas.width*parmas.pointX;var width=b_canvas.width*parmas.width;var height=width*(rows/cols);var pointY=height*parmas.pointY;var cell_height=height/rows;
var cell_width=width/cols;var x=cell_width*col+pointX;var y=cell_height*row+pointY;var textimg=new Image();if(isText){var imgstr="img/game/bacc/road/bigTableView/tie"+imglist[tiecount]+".png";textimg.src=imgstr}img.onload=function(){if(isText){ctx.clearRect(x+1,y+1,cell_width-2,cell_height-2);textimg.onload=function(){ctx.drawImage(img,x+1,y+1,cell_width-2,cell_height-2);ctx.drawImage(textimg,x+1,y+1,cell_width-2,cell_height-2)}}else{ctx.drawImage(img,x+1,y+1,cell_width-2,cell_height-2)}}}}};
